# ğŸ› ï¸ Guia PrÃ¡tico: Como manter branches Git locais sincronizadas e limpas

ğŸ“… Atualizado em: `2025-08-06` â€¢ ğŸ”– VersÃ£o: `1.1`

---

## ğŸ“š SumÃ¡rio

- [ğŸ¯ Contexto e Objetivo](#contexto-e-objetivo)
- [âœ… PrÃ©-requisitos](#prÃ©-requisitos)
- [ğŸš¶ Passo a passo](#passo-a-passo)
  - [1ï¸âƒ£ Remover branches locais que foram deletadas no remoto (sincronizar e podar)](#1ï¸âƒ£-remover-branches-locais-que-foram-deletadas-no-remoto-sincronizar-e-podar)
  - [2ï¸âƒ£ Remover automaticamente branches que existem apenas localmente](#2ï¸âƒ£-remover-automaticamente-branches-que-existem-apenas-localmente)
  - [3ï¸âƒ£ Validar o resultado e revisar o estado](#3ï¸âƒ£-validar-o-resultado-e-revisar-o-estado)
  - [4ï¸âƒ£ Opcional: configurar pruning automÃ¡tico e boas prÃ¡ticas](#4ï¸âƒ£-opcional-configurar-pruning-automÃ¡tico-e-boas-prÃ¡ticas)
- [âš ï¸ Armadilhas comuns](#armadilhas-comuns)
- [ğŸ› ï¸ Troubleshooting (Erros Comuns)](#troubleshooting-erros-comuns)
- [ğŸ“ ReferÃªncias](#referÃªncias)

---

## ğŸ¯ Contexto e Objetivo

Este guia resolve o acÃºmulo de branches no repositÃ³rio Git local que:

- JÃ¡ foram mescladas e deletadas no GitHub (marcadas como [gone]).
- Foram criadas apenas localmente e nunca tiveram tracking remoto.

Resultado esperado:

- Ambiente local limpo, apenas com branches relevantes.
- RemoÃ§Ã£o segura das referÃªncias obsoletas ao remoto.
- RemoÃ§Ã£o automatizada de branches somente locais (excluindo a branch atual).

Para quem Ã© Ãºtil:

- Pessoas desenvolvedoras que mantÃªm muitos branches.
- Times que desejam padronizar a limpeza do repositÃ³rio local.

Ao final, vocÃª terÃ¡ executado comandos para sincronizar com o remoto, remover branches obsoletas e configurar pruning automÃ¡tico.

---

## âœ… PrÃ©-requisitos

- âœ… Sistemas operacionais suportados: Windows 10+ (PowerShell), macOS 12+ e Linux (bash/zsh)
- âœ… Git instalado e no PATH:
  - Windows: https://git-scm.com/download/win
  - macOS: https://git-scm.com/download/mac
  - Linux: https://git-scm.com/download/linux
- âœ… PermissÃµes para executar comandos no terminal (PowerShell ou bash)
- âœ… RepositÃ³rio clonado e com remoto configurado (ex.: origin â†’ GitHub)
- âœ… ObservaÃ§Ã£o: comandos PowerShell usam pipeline e cmdlets; oferecemos alternativas em bash quando aplicÃ¡vel.

---

## ğŸš¶ Passo a passo

> Os comandos a seguir foram testados. Use a variante adequada ao seu shell.

### 1ï¸âƒ£ Remover branches locais que foram deletadas no remoto (sincronizar e podar)

Sincroniza com o remoto, remove referÃªncias de tracking obsoletas e apaga branches locais marcadas como [gone].

```powershell
git fetch -p; git branch -vv | Where-Object { $_ -match ": gone]" } | ForEach-Object { $_.Trim().Split(' ')[0] } | ForEach-Object { if ($_.Length -gt 0) { git branch -d $_ } }
```

Alternativa bash/zsh:

```bash
git fetch -p
git branch -vv | awk '/: gone]/{print $1}' | xargs -r -n 1 git branch -d
```

O que acontece:

- git fetch -p (ou --prune): remove referÃªncias remotas obsoletas.
- git branch -vv: lista branches com status de tracking; linhas com [: gone] indicam que a branch remota nÃ£o existe mais.
- RemoÃ§Ã£o usa git branch -d (seguro, evita apagar branches com commits nÃ£o mesclados).

---

### 2ï¸âƒ£ Remover automaticamente branches que existem apenas localmente

Apaga todas as branches sem vÃ­nculo remoto e que nÃ£o sÃ£o a branch atual.

```powershell
git branch -vv | Where-Object { ($_ -notmatch '\[') -and ($_ -notmatch '\*') } | ForEach-Object { $_.Trim().Split(' ')[0] } | ForEach-Object { if ($_.Length -gt 0) { git branch -D $_ } }
```

Alternativa bash/zsh:

```bash
git branch -vv \
| awk '!/\[/ && !/^\*/ {print $1}' \
| xargs -r -n 1 git branch -D
```

Notas:

- Filtro sem [ indica ausÃªncia de tracking remoto.
- ExclusÃ£o usa -D (forÃ§ado), pois podem existir commits nÃ£o enviados. Use com cautela.

---

### 3ï¸âƒ£ Validar o resultado e revisar o estado

Listar branches restantes e verificar tracking:

```bash
git branch -vv
```

Dicas de revisÃ£o:

- Verifique se branches relevantes (ex.: main, develop, release/â€¦) permanecem.
- Se algo importante foi removido, restaure via reflog (veja Troubleshooting).
- Opcional: remover localmente branches jÃ¡ mescladas em main/develop:

```bash
# Exemplo: remover branches totalmente mescladas em main
git checkout main
git pull --ff-only
git branch --merged | grep -vE '^\*|^(main|master|develop)$' | xargs -r -n 1 git branch -d
```

---

### 4ï¸âƒ£ Opcional: configurar pruning automÃ¡tico e boas prÃ¡ticas

Ative prune no fetch para manter refs limpas:

```bash
# Em todos os repositÃ³rios do usuÃ¡rio
git config --global fetch.prune true

# Apenas neste repositÃ³rio
git config fetch.prune true
```

Outras recomendaÃ§Ãµes:

- Use nomes coerentes e efÃªmeros para branches de feature/bugfix.
- FaÃ§a merge ou rebase e crie PRs pequenos para reduzir branches â€œmortasâ€.
- Periodicamente rode git remote prune origin para limpar refs remotas:

```bash
git remote prune origin
```

---

## âš ï¸ Armadilhas comuns

- â— Apagar a branch atual
  ğŸ” Causa: tentativa de deletar a branch em uso.
  ğŸ› ï¸ SoluÃ§Ã£o: troque de branch antes (ex.: git checkout main) e repita o comando.

- â— Perder commits locais nÃ£o enviados
  ğŸ” Causa: uso de -D em branch sem push.
  ğŸ› ï¸ SoluÃ§Ã£o: prefira -d quando possÃ­vel; entenda os riscos de -D. Use reflog para recuperar.

- â— Detached HEAD
  ğŸ” Causa: estar â€œpresoâ€ a um commit especÃ­fico.
  ğŸ› ï¸ SoluÃ§Ã£o: volte a uma branch nomeada (git checkout main) antes de limpar.

- â— Remoto diferente de origin
  ğŸ” Causa: comandos assumem origin como remoto padrÃ£o.
  ğŸ› ï¸ SoluÃ§Ã£o: ajuste para o nome real do remoto (git remote -v; use-o nos comandos).

- â— ExecuÃ§Ã£o no PowerShell restrita
  ğŸ” Causa: polÃ­tica de execuÃ§Ã£o bloqueando scripts/linhas avanÃ§adas.
  ğŸ› ï¸ SoluÃ§Ã£o: execute no Windows Terminal com PowerShell atualizado ou use a alternativa bash (Git Bash).

---

## ğŸ› ï¸ Troubleshooting (Erros Comuns)

- ğŸ’¥ â€œerror: The branch 'X' is not fully mergedâ€
  â†’ Causa: branch tem commits nÃ£o integrados.
  â†’ AÃ§Ã£o: revise o diff; se tiver certeza, use -D. Caso contrÃ¡rio, faÃ§a merge/rebase antes.

- ğŸ” Recuperar branch apagada por engano
  â†’ Use o reflog para encontrar o Ãºltimo HEAD e recriar a branch:

  ```bash
  git reflog
  git checkout -b nome-branch RECENT_HEAD_HASH
  ```

- ğŸ§­ Listar branches remotas e tracking

  ```bash
  git branch -r
  git branch -vv
  ```

- ğŸ§¹ Limpar referÃªncias remotas obsoletas manualmente

  ```bash
  git remote prune origin
  ```

- ğŸ”„ Atualizar refs antes de decidir

  ```bash
  git fetch -p
  git branch -vv
  ```

- ğŸªª â€œPermission deniedâ€ (scripts no Linux/macOS)
  â†’ Causa: falta de permissÃ£o de execuÃ§Ã£o.
  â†’ AÃ§Ã£o:
  ```bash
  chmod +x script.sh
  ```

---

## ğŸ“ ReferÃªncias

- ğŸ“˜ Git fetch: https://git-scm.com/docs/git-fetch
- ğŸ“˜ Git branch: https://git-scm.com/docs/git-branch
- ğŸ“˜ Git remote prune: https://git-scm.com/docs/git-remote#Documentation/git-remote.txt-empruneem
- ğŸ“˜ Git config: https://git-scm.com/docs/git-config

---

### âœ”ï¸ Dicas finais

- Repita a limpeza periodicamente para manter o repositÃ³rio saudÃ¡vel.
- Prefira -d para exclusÃµes seguras; use -D apenas quando tiver certeza.
- Ative fetch.prune para automatizar parte da manutenÃ§Ã£o.
